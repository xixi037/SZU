<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>中期报告</title>
    <link rel="stylesheet" href="/static/Bootstrap/css/bootstrap.min.css">
    {#    <script type="text/javascript" src="/static/js/jquery.formLocalStorage.js"></script>#}
    <link rel="stylesheet" href="/static/js/theme/default/laydate.css?v=5.0.8"
          id="layuicss-laydate">
    <script type="text/javascript" src="/static/js/laydate.js"></script>
    <script type="text/javascript" src="/static/js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="/static/js/FileSaver.js"></script>
    <script type="text/javascript" src="/static/js/jquery.wordexport.js"></script>
    <style>
{#        .container {#}
{#            padding-right: 15px;#}
{#            padding-left: 15px;#}
{#            margin-right: auto;#}
{#            margin-left: auto;#}
{#        }#}

        pre {
            white-space: pre-wrap; /* css-3 */
            white-space: -moz-pre-wrap; /* Mozilla, since 1999 */
            word-wrap: break-word; /* Internet Explorer 5.5+ */
            word-break: break-all;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div class="container">
    <form id="info">
        {#    {% csrf_token %}#}
        | 基本信息：
        <table id="t1" class="table">
            <tbody>
            <tr>
                <td>项目编号</td>
                <td><input type="text" name="pro_num" id="pro_num" value={{ info.pro_num }}></td>
                <td>项目名称</td>
                <td><input type="text" name="pro_name" id="pro_name" readonly="true" value={{ info.pro_name }}></td>
                <td>项目负责人</td>
                <td><input type="text" name="pro_leader" readonly="true" value={{ info.pro_leader }}></td>
            </tr>
            <tr>
                <td>负责人学号</td>
                <td><input type="text" name="leader_stuID" readonly="true" value={{ info.leader_id }}></td>
                <td>负责人联系电话</td>
                <td><input type="text" name="leader_phone" readonly="true" value={{ info.leader_phone }}></td>
                <td>项目组成员</td>
                <td><input type="text" name="pro_mems" readonly="true" value={{ info.pro_mems }}></td>
            </tr>
            <tr>
                <td>指导老师</td>
                <td><input type="text" name="tutor_name" readonly="true" value={{ info.tutor_id }}></td>
                <td>项目起止期限</td>
                <td><input type="text" name="pro_stime" id="time1" placeholder="起始时间" value={{ info.pro_stime }}></td>
                <td><input type="text" name="pro_etime" id="time2" placeholder="终止时间" value={{ info.pro_etime }}></td>
                <td><input type="text" name="pro_endtime" id="time3" placeholder="预计完成时间" value={{ info.pro_endtime }}>
                </td>
            </tr>
            </tbody>
        </table>
        <div id="d1">
            | 项目具体信息：<br>
            项目进度与阶段性成果说明（项目整体安排及目前进度说明、项目组成员自主完成的工作与取得的阶段性成果）<br>
            <textarea rows="4" cols="150" name="pro_schedule" wrap="hard" id="text1">{{ info.pro_schedule }}
        </textarea><br>
            实验资源使用情况(使用了哪些实验室、使用次数、使用总时数及设备使用情况等)<br>
            <textarea rows="4" cols="150" name="pro_source" wrap="hard" id="text2">{{ info.pro_source }}
        </textarea><br>
            经费使用情况(用于材料、元件和书籍的购买及路费等的支出情况，费用报销及垫付情况等)<br>
            <textarea rows="4" cols="150" name="pro_money" wrap="hard" id="text3">{{ info.pro_money }}
        </textarea><br>
            项目难点（目前存在的问题与困难）<br>
            <textarea rows="4" cols="150" name="pro_difficulties" wrap="hard" id="text4">{{ info.pro_difficulties }}
        </textarea><br>
            对实验中心、指导老师的建议(开放时间、元器件提供、实验设备、大型仪器设备及技术支持等)<br>
            <textarea rows="4" cols="150" name="pro_advice" wrap="hard" id="text5">{{ info.pro_advice }}
        </textarea><br>
            项目变更信息（研究名称或内容、实施方案、项目成员、项目完成时间、指导教师等方面的调整与变动）没有变更请填“无”<br>
            <textarea rows="4" cols="150" name="pro_change" wrap="hard" id="text6">{{ info.pro_change }}
        </textarea><br>
            后期计划（后期任务及实施方案）<br>
            <textarea rows="4" cols="150" name="pro_plan" wrap="hard" id="text7">{{ info.pro_plan }}
        </textarea><br>
            团队协作（项目组成员合作、讨论、交流情况以及项目实施过程中成员各方面的收获）<br>
            <textarea rows="4" cols="150" name="pro_harvest" wrap="hard" id="text8">{{ info.pro_harvest }}
        </textarea><br>
        </div>
        <input hidden name="status" id="status" value="0">
    </form>
    <button type="button" id="save">保存</button>
    <button type="button" id="sub">提交</button>
    <button type="button" id="close">关闭</button>

    {#<button type="button" id="exportword">导出word</button>#}
    <section id="model_section" class="container"></section>
</div>
<script>
    laydate.render({
        elem: '#time1' //指定元素
    });
    laydate.render({
        elem: '#time2' //指定元素
    });
    laydate.render({
        elem: '#time3' //指定元素
    });
    $(document).ready(function () {
        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
        });
        $('#save').click(function () {
            var data = $('#info').serializeArray();
            console.log(data);
            $.ajax({
                url: '/middle_save',
                data: {
                    'info': JSON.stringify(data)
                },
                type: 'POST',
                success: function (data) {
                    alert('保存成功！');
                },
                error: function (data) {
                    console.log(data);
                }
            })
        });
        $('#sub').click(function () {
            var flag = 1;
            for (var i = 0; i < $('#info input').length; i++) {
                if ($.trim($('#info input')[i].value) == "") {
                    alert('需要全部填写，若没有则写"无"');
                    flag = 0;
                    break;
                }
            }
            if (flag == 1) {
                for (i = 0; i < $('#info textarea').length; i++) {
                    if ($.trim($('#info textarea')[i].value) == "") {
                        alert('需要全部填写，若没有则写"无"');
                        flag = 0;
                        break;
                    }
                }
                if (flag == 1) {
                    $('#status').val('1');
                    var data = $('#info').serializeArray();
                    console.log(data);
                    $.ajax({
                        url: '/middle_save',
                        data: {
                            'info': JSON.stringify(data)
                        },
                        type: 'POST',
                        success: function (data) {
                            console.log(data);
                            alert('提交成功！');
                            window.location.href = '/base';
{#                            $('#model_section').html(data);#}
                        },
                        error: function (data) {
                            console.log(data);
                        }
                    })

                }
            }


        });
        $('#close').click(function () {
            window.location.href = '/base'
        });

    });

</script>
</body>
</html>